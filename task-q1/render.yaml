services:
  - type: web
    name: ecommerce-backend
    env: node
    buildCommand: cd server && npm install
    startCommand: cd server && node index.js
    envVars:
      - key: MONGO_URI
        sync: false
      - key: NODE_ENV
        value: production

  - type: web
    name: ecommerce-frontend
    env: static
    buildCommand: |
      cd task-q1/client && 
      mkdir -p public src && 
      echo '<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="%PUBLIC_URL%/favicon.ico"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="theme-color" content="#000000"/><meta name="description" content="Furniro - Your Furniture Store"/><link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png"/><link rel="manifest" href="%PUBLIC_URL%/manifest.json"/><title>Furniro</title></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"></div></body></html>' > public/index.html && 
      echo '{"short_name":"Furniro","name":"Furniro - Your Furniture Store","icons":[{"src":"favicon.ico","sizes":"64x64 32x32 24x24 16x16","type":"image/x-icon"}],"start_url":".","display":"standalone","theme_color":"#000000","background_color":"#ffffff"}' > public/manifest.json && 
      echo 'import React from "react";import ReactDOM from "react-dom/client";import "./index.css";import App from "./App";const root = ReactDOM.createRoot(document.getElementById("root"));root.render(<React.StrictMode><App /></React.StrictMode>);' > src/index.js && 
      echo 'import React from "react";import "./App.css";function App() {return (<div className="App"><header className="App-header"><h1>Welcome to Furniro</h1><p>Your Furniture Store</p></header></div>);}export default App;' > src/App.js && 
      echo '.App{text-align:center}.App-header{background-color:#282c34;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:calc(10px + 2vmin);color:white}' > src/App.css && 
      echo 'body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}code{font-family:source-code-pro,Menlo,Monaco,Consolas,"Courier New",monospace}' > src/index.css && 
      echo '{"name":"furniro-client","version":"0.1.0","private":true,"dependencies":{"@testing-library/jest-dom":"5.17.0","@testing-library/react":"13.4.0","@testing-library/user-event":"13.5.0","axios":"1.6.7","react":"18.2.0","react-dom":"18.2.0","react-scripts":"5.0.1","web-vitals":"2.1.4"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject"},"eslintConfig":{"extends":["react-app","react-app/jest"]},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}' > package.json && 
      npm install && 
      npm run build
    staticPublishPath: client/build
    envVars:
      - key: REACT_APP_API_URL
        value: https://furniro-backend-1-pt38.onrender.com
